<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">

<link rel="import" href="../../bower_components/paper-input/paper-input.html">

<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">



<link rel="import" href="shared-styles.html">

<dom-module id="config-builder">
  <template>
    <style include="shared-styles">
      :host{
        --primary-color: var(--paper-grey-900);
      }
      paper-dropdown-menu.custom {
        width: 13em;    
        --paper-input-container-label: {
          text-transform: capitalize;
          color: var(--paper-grey-400);
        };
      }
      paper-input {
        --paper-input-container-label: {
            text-transform: capitalize;
            color: var(--paper-grey-400);
        };
        width: 13em;
      }
      paper-checkbox {
          margin: .7em 0;
      }
      .devider {
        width: 100%;
        height: 2em;
        color: var(--paper-grey-800);
        text-align: center;
        text-transform: uppercase;
        line-height: 2em;
        background-color: #e0e0e0;
      }
      .undercover {
        padding: 1em;
        transition: background-color .7s;
      }
      .undercover:hover {
        background-color: #fff !important;
        transition: background-color .3s;
      }
      .undercover:nth-child(odd) {
        background-color: rgba(255,255,255,.5);
      }
      .container {  
        margin: .3em .5em;
      }
      .item-name {
        text-transform: capitalize;
        font-weight: bold ;
      }
      .description {
        padding: .2em 0;
        font-size: .9em
      }
    </style>
    <iron-ajax
        id="setConfig"
        url="{{url}}"
        handle-as="json"
        loading="{{loading}}"
        on-response="_dataConvert"
        last-response="{{response}}"></iron-ajax>
          
      <div class="devider">
        <p>[[response.title]]</p>
      </div>   

        <template is="dom-repeat" items="[[ajaxContent]]">
          <div class="undercover">
            <template is="dom-if" if="[[getDropdown(item.enum)]]">
              <div class="container">
                <div class="item-name">[[item.key]]</div>
                <div class="description">[[item.description]]</div>
                <paper-dropdown-menu class="custom" label="[[item.key]]" on-iron-select="dropdownChanged" horizontal-align="left">
                    <paper-listbox slot="dropdown-content" class="dropdown-content">
                    <template is="dom-repeat" items="[[item.enum]]">
                        <paper-item>[[item]]</paper-item>
                    </template>
                    </paper-listbox>
                </paper-dropdown-menu>
              </div>
            </template>
            <template is="dom-if" if="[[!getSwitch(item.type)]]">
              <div class="container">
                <div class="item-name">[[item.key]]</div>
                <div class="description">[[item.description]]</div>
                <paper-checkbox name="[[item.key]]" checked="[[getSwitch(item.type)]]" on-change="checkboxChanged">[[getSwitch(item.type)]]</paper-checkbox>
              </div>
            </template>
            <template is="dom-if" if="[[getTextInput(item.type, item.enum)]]">
              <div class="container">
                <div class="item-name">[[item.key]]</div>
                <div class="description">[[item.description]]</div>
                <paper-input always-float-label label="[[item.key]]" on-blur="inputChanged"></paper-input>
              </div>
            </template>
          </div>
        </template>
        
  </template>
  <script>
    class configBuilder extends Polymer.Element {
      static get is() { return 'config-builder'; }
      static get properties() {
        return {
            url: {
              type: String,
              observer: '_gotUrl'
            },
            ajaxContent: {
              type: Array,
              value: [],
              notify: true
            },
            response: {
              type: Object
            },
            userConfig: {
              type: Object,
              value: {
                name: '',
                options: {
                  
                }
              }
            }
         }
      }

      _gotUrl() {
          this.$.setConfig.generateRequest();
      }

      _dataConvert() {
        this.userConfig.name = this.response.title.split(' ')[0];
        let obj = this.response.definitions.options.properties;
        let array = [];
        for (var index in obj) {
          (index!='') ? obj[index].key = index.replace('--', '') : obj[index].key = 'path';
          array.push(obj[index]);
        }
        this.ajaxContent = array.slice();
      }

      getDropdown(type) {
        if (type !== undefined) {
            return true
        } else {
            return false
        }
      }
      
      getSwitch(type) {
        if (type + '' == 'null') {
          return false
        } else {
          return true
        }
      }

      getTextInput(type, notDropdown) {
        if (type == 'string' && notDropdown == undefined) {
          return true
        } else {
          return false
        }
      }

      dropdownChanged(e) {
        let node = e.target;
        this.userConfig.options['--' + node.parentNode.label] = node.selectedItem.innerText;
        console.log(this.userConfig)
      }

      checkboxChanged(e) {
        let node = e.target;
        (node.checked) ? node.innerHTML = 'true' :  node.innerHTML = 'false';
        this.userConfig.options['--' + node.name] = node.checked;
        console.log(this.userConfig)
      }

      inputChanged(e) {
        if (e.target.value=='') return
        this.userConfig.options['--' + e.target.label] = e.target.value;
        console.log(this.userConfig)
      }

    }
    window.customElements.define(configBuilder.is, configBuilder);
  </script>
</dom-module>
